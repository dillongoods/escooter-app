{% import 'components/hireForm.html' as hireForm %}{% extends "base/index.html"
%} {% block content %}
<div class="w-full mx-auto flex flex-col h-full justify-start mb-auto mt-16">
  <span class="text-h6">Available spots</span>
  <span class="text-gray-600 mt-1"
    >Choose any one of our renting spots and we will show you available scooters
    to rent</span
  >
  <div class="flex h-4/6 mt-6">
    <div
      id="hireMap"
      class="rounded-tl-xl rounded-bl-xl border border-gray-500 w-full h-full"
    ></div>
    <div
      class="flex flex-col h-full ml-6 border-black border rounded-tr-lg rounded-br-lg w-1/3"
    >
      <div class="p-6 py-4 border-b border-b-black">
        <span class="text-h4">Scooters</span>
      </div>
      <div
        class="flex-1 flex justify-center items-center"
        id="scooterContainer"
      >
        <span class="text-body-lg text-gray-600 text-center"
          >Please select one of pickup spots.</span
        >
      </div>
    </div>
  </div>
</div>
<script>
  function removeAllChildNodes(parent) {
    while (parent.firstChild) {
      parent.removeChild(parent.firstChild);
    }
  }

  function appendEmptyText(parent) {
    const span = document.createElement("span");
    span.innerHTML = "There are no available scooters in this location";

    span.className = "text-body-lg text-gray-600 text-center";
    parent.appendChild(span);
  }

  function initMap() {
    const scooterContainer = document.getElementById("scooterContainer");

    const center = { lat: 53.8001179, lng: -1.5485432 };

    const addLocationMap = document.getElementById("hireMap");

    // Create a map and display it
    const map = new google.maps.Map(addLocationMap, {
      zoom: 14,
      center: center,
    });

    // Get all scooter locations
    $.ajax({
      url: "/api/getLocations",
    }).done(function (res) {
      // Go over locations and create markers
      res.locations.map((location) => {
        // Create a marker for that location
        const marker = new google.maps.Marker({
          position: {
            lat: Number(location.y_cord),
            lng: Number(location.x_cord),
          },
          map: map,
          title: location.name,
          icon: "static/favicon.ico",
        });

        // add a listener to the marker so that when the marker is clicked, we fetch all scooters in that location
        marker.addListener("click", (e) => {
          $.ajax({
            url: `/api/getScooters?location=${marker.title}`,
          }).done(function ({ scooters }) {
            // remove everything in scooter container div
            removeAllChildNodes(scooterContainer);

            if (!scooters.length) {
              appendEmptyText(scooterContainer);
            }
          });
        });
      });
    });
  }
</script>
{% endblock %}

<!-- {{hireForm.hireForm(form)}} -->
